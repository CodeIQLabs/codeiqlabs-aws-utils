{
  "$ref": "#/definitions/WorkloadAppConfig",
  "definitions": {
    "WorkloadAppConfig": {
      "type": "object",
      "properties": {
        "project": {
          "type": "string",
          "minLength": 1,
          "errorMessage": {
            "minLength": "Project name cannot be empty"
          }
        },
        "company": {
          "type": "string",
          "minLength": 1,
          "errorMessage": {
            "minLength": "Company name cannot be empty"
          }
        },
        "type": {
          "type": "string",
          "const": "workload"
        },
        "environments": {
          "type": "object",
          "additionalProperties": {
            "type": "object",
            "properties": {
              "accountId": {
                "type": "string",
                "pattern": "^[0-9]{12}$",
                "errorMessage": {
                  "pattern": "AWS Account ID must be exactly 12 digits"
                }
              },
              "region": {
                "type": "string",
                "pattern": "^[a-z]{2}-[a-z]+-\\d+$",
                "errorMessage": {
                  "pattern": "Invalid AWS region format (expected: us-east-1, eu-west-1, etc.)"
                }
              },
              "environment": {
                "type": "string",
                "enum": ["nprd", "pprd", "prod", "mgmt", "shrd"]
              },
              "config": {
                "type": "object",
                "properties": {
                  "scaling": {
                    "type": "object",
                    "properties": {
                      "minCapacity": {
                        "type": "integer",
                        "minimum": 0
                      },
                      "maxCapacity": {
                        "type": "integer",
                        "minimum": 1
                      },
                      "targetUtilization": {
                        "type": "number",
                        "minimum": 0,
                        "maximum": 100
                      }
                    },
                    "additionalProperties": false
                  },
                  "monitoring": {
                    "type": "object",
                    "properties": {
                      "enableDetailedMonitoring": {
                        "type": "boolean",
                        "default": true
                      },
                      "logLevel": {
                        "type": "string",
                        "enum": ["DEBUG", "INFO", "WARN", "ERROR"],
                        "default": "INFO"
                      },
                      "enableXRayTracing": {
                        "type": "boolean",
                        "default": true
                      }
                    },
                    "additionalProperties": false
                  },
                  "security": {
                    "type": "object",
                    "properties": {
                      "enableWaf": {
                        "type": "boolean",
                        "default": true
                      },
                      "enableShield": {
                        "type": "boolean",
                        "default": false
                      },
                      "enableGuardDuty": {
                        "type": "boolean",
                        "default": true
                      }
                    },
                    "additionalProperties": false
                  },
                  "backup": {
                    "type": "object",
                    "properties": {
                      "enabled": {
                        "type": "boolean",
                        "default": true
                      },
                      "retentionDays": {
                        "type": "integer",
                        "minimum": 1,
                        "maximum": 36500,
                        "default": 30
                      },
                      "crossRegionBackup": {
                        "type": "boolean",
                        "default": false
                      }
                    },
                    "additionalProperties": false
                  }
                },
                "additionalProperties": false
              }
            },
            "required": ["accountId", "region", "environment"],
            "additionalProperties": false
          }
        },
        "management": {
          "type": "object",
          "properties": {
            "accountId": {
              "type": "string",
              "pattern": "^[0-9]{12}$",
              "errorMessage": {
                "pattern": "AWS Account ID must be exactly 12 digits"
              }
            },
            "region": {
              "type": "string",
              "pattern": "^[a-z]{2}-[a-z]+-\\d+$",
              "errorMessage": {
                "pattern": "Invalid AWS region format (expected: us-east-1, eu-west-1, etc.)"
              }
            },
            "environment": {
              "type": "string",
              "enum": ["nprd", "pprd", "prod", "mgmt", "shrd"]
            }
          },
          "required": ["accountId", "region", "environment"],
          "additionalProperties": false
        },
        "deploymentPermissions": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true
            },
            "mode": {
              "type": "string",
              "enum": ["create", "adopt"],
              "default": "create"
            },
            "projects": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string",
                    "pattern": "^[a-zA-Z0-9\\s_-]+$",
                    "errorMessage": {
                      "pattern": "Name must contain only alphanumeric characters, spaces, hyphens, and underscores",
                      "minLength": "Name cannot be empty"
                    },
                    "minLength": 1
                  },
                  "environments": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string",
                          "minLength": 1,
                          "errorMessage": {
                            "minLength": "Environment name is required"
                          }
                        },
                        "accountId": {
                          "type": "string",
                          "pattern": "^[0-9]{12}$",
                          "errorMessage": {
                            "pattern": "AWS Account ID must be exactly 12 digits"
                          }
                        },
                        "region": {
                          "type": "string",
                          "pattern": "^[a-z]{2}-[a-z]+-\\d+$",
                          "errorMessage": {
                            "pattern": "Invalid AWS region format (expected: us-east-1, eu-west-1, etc.)"
                          }
                        }
                      },
                      "required": ["name", "accountId", "region"],
                      "additionalProperties": false
                    },
                    "minItems": 1,
                    "errorMessage": {
                      "minItems": "At least one environment is required"
                    }
                  }
                },
                "required": ["name", "environments"],
                "additionalProperties": false
              },
              "minItems": 1,
              "errorMessage": {
                "minItems": "At least one project is required"
              }
            },
            "crossAccountRoles": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "roleName": {
                    "type": "string",
                    "minLength": 1,
                    "errorMessage": {
                      "minLength": "Role name is required"
                    }
                  },
                  "trustedAccountId": {
                    "type": "string",
                    "pattern": "^[0-9]{12}$",
                    "errorMessage": {
                      "pattern": "AWS Account ID must be exactly 12 digits"
                    }
                  },
                  "sessionDuration": {
                    "type": "string",
                    "pattern": "^P(?:(\\d+)Y)?(?:(\\d+)M)?(?:(\\d+)D)?(?:T(?:(\\d+)H)?(?:(\\d+)M)?(?:(\\d+)S)?)?$",
                    "errorMessage": {
                      "pattern": "Invalid ISO 8601 duration format (expected: PT1H30M, P1D, etc.)"
                    }
                  },
                  "externalId": {
                    "type": "string"
                  }
                },
                "required": ["roleName", "trustedAccountId"],
                "additionalProperties": false
              }
            },
            "githubOidc": {
              "type": "object",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "default": true
                },
                "repositoryPattern": {
                  "type": "string",
                  "minLength": 1,
                  "errorMessage": {
                    "minLength": "Repository pattern is required"
                  }
                },
                "roleName": {
                  "type": "string",
                  "minLength": 1,
                  "errorMessage": {
                    "minLength": "Role name is required"
                  }
                },
                "sessionDuration": {
                  "type": "string",
                  "pattern": "^P(?:(\\d+)Y)?(?:(\\d+)M)?(?:(\\d+)D)?(?:T(?:(\\d+)H)?(?:(\\d+)M)?(?:(\\d+)S)?)?$",
                  "errorMessage": {
                    "pattern": "Invalid ISO 8601 duration format (expected: PT1H30M, P1D, etc.)"
                  }
                }
              },
              "required": ["repositoryPattern", "roleName"],
              "additionalProperties": false
            }
          },
          "required": ["projects"],
          "additionalProperties": false
        },
        "applications": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string",
                "minLength": 1,
                "maxLength": 64
              },
              "description": {
                "type": "string"
              },
              "version": {
                "type": "string"
              },
              "runtime": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "enum": ["container", "serverless", "vm", "static"]
                  },
                  "platform": {
                    "type": "string"
                  },
                  "version": {
                    "type": "string"
                  }
                },
                "additionalProperties": false
              },
              "dependencies": {
                "type": "object",
                "properties": {
                  "databases": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  },
                  "queues": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  },
                  "apis": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  },
                  "storage": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  }
                },
                "additionalProperties": false
              }
            },
            "required": ["name"],
            "additionalProperties": false
          }
        },
        "options": {
          "type": "object",
          "properties": {
            "enableBlueGreenDeployment": {
              "type": "boolean",
              "default": false
            },
            "enableCanaryDeployment": {
              "type": "boolean",
              "default": false
            },
            "enableAutoRollback": {
              "type": "boolean",
              "default": true
            },
            "enableDisasterRecovery": {
              "type": "boolean",
              "default": false
            },
            "enableAutomatedTesting": {
              "type": "boolean",
              "default": true
            },
            "enableSecurityScanning": {
              "type": "boolean",
              "default": true
            },
            "defaultTags": {
              "type": "object",
              "additionalProperties": {
                "type": "string"
              }
            },
            "resourcePrefix": {
              "type": "string"
            },
            "enableCostOptimization": {
              "type": "boolean",
              "default": true
            },
            "enablePerformanceMonitoring": {
              "type": "boolean",
              "default": true
            },
            "promotionOrder": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          },
          "additionalProperties": false
        }
      },
      "required": ["project", "company", "type", "environments", "management"],
      "additionalProperties": false
    }
  },
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "WorkloadAppConfig",
  "description": "Schema for CodeIQLabs workload account manifest files",
  "$id": "https://raw.githubusercontent.com/CodeIQLabs/codeiqlabs-aws-utils/main/schemas/workload-manifest.schema.json"
}
