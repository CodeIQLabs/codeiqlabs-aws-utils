{
  "$id": "https://schemas.codeiqlabs.dev/aws/manifest.schema.json",
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "CodeIQLabs AWS Manifest (Unified)",
  "description": "Unified schema for CodeIQLabs AWS manifest files. Supports component-based configuration where any component can be deployed to any account. No manifestType field - components define what gets deployed.",
  "$ref": "definitions/CodeIQLabsAwsManifest",
  "definitions": {
    "CodeIQLabsAwsManifest": {
      "type": "object",
      "properties": {
        "naming": {
          "type": "object",
          "properties": {
            "company": {
              "type": "string",
              "minLength": 1
            },
            "project": {
              "type": "string",
              "minLength": 1
            },
            "owner": {
              "type": "string",
              "minLength": 1
            },
            "skipEnvironmentName": {
              "type": "boolean"
            }
          },
          "required": ["company", "project"],
          "additionalProperties": false,
          "errorMessage": {
            "required": {
              "company": "Missing required property: company",
              "project": "Missing required property: project"
            }
          }
        },
        "environments": {
          "type": "object",
          "additionalProperties": {
            "type": "object",
            "properties": {
              "accountId": {
                "type": "string",
                "pattern": "^[0-9]{12}$"
              },
              "region": {
                "type": "string",
                "pattern": "^[a-z]{2}-[a-z]+-\\d{1,2}$"
              },
              "config": {
                "type": "object",
                "additionalProperties": {}
              }
            },
            "required": ["accountId", "region"],
            "additionalProperties": false
          }
        },
        "defaults": {
          "type": "object",
          "properties": {
            "ecs": {
              "type": "object",
              "properties": {
                "webapp": {
                  "type": "object",
                  "properties": {
                    "cpu": {
                      "type": "number",
                      "default": 256
                    },
                    "memoryMiB": {
                      "type": "number",
                      "default": 512
                    },
                    "desiredCount": {
                      "type": "number",
                      "default": 1
                    }
                  },
                  "additionalProperties": false
                },
                "api": {
                  "type": "object",
                  "properties": {
                    "cpu": {
                      "type": "number",
                      "default": 512
                    },
                    "memoryMiB": {
                      "type": "number",
                      "default": 1024
                    },
                    "desiredCount": {
                      "type": "number",
                      "default": 1
                    }
                  },
                  "additionalProperties": false
                }
              },
              "additionalProperties": false
            },
            "lambda": {
              "type": "object",
              "properties": {
                "memorySize": {
                  "type": "number",
                  "minimum": 128,
                  "maximum": 10240,
                  "default": 1024
                },
                "timeout": {
                  "type": "number",
                  "minimum": 1,
                  "maximum": 900,
                  "default": 30
                },
                "eventBridgeBusName": {
                  "type": "string"
                }
              },
              "additionalProperties": false
            },
            "aurora": {
              "type": "object",
              "properties": {
                "minCapacity": {
                  "type": "number",
                  "default": 0.5
                },
                "maxCapacity": {
                  "type": "number",
                  "default": 2
                },
                "engineVersion": {
                  "type": "string",
                  "default": "16.4"
                }
              },
              "additionalProperties": false
            }
          },
          "additionalProperties": false
        },
        "saasApps": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string",
                "minLength": 1
              },
              "domain": {
                "type": "string",
                "minLength": 1
              },
              "marketingOnly": {
                "type": "boolean"
              },
              "hasApi": {
                "type": "boolean"
              },
              "hasWebapp": {
                "type": "boolean"
              }
            },
            "required": ["name", "domain"],
            "additionalProperties": false,
            "errorMessage": {
              "required": {
                "name": "Missing required property: name",
                "domain": "Missing required property: domain"
              }
            }
          }
        },
        "saasEdge": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "domain": {
                "type": "string",
                "minLength": 1
              },
              "distributions": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "type": {
                      "type": "string",
                      "enum": ["marketing", "webapp", "api"]
                    },
                    "originType": {
                      "type": "string",
                      "enum": ["alb", "apiGateway", "s3"]
                    }
                  },
                  "required": ["type"],
                  "additionalProperties": false,
                  "errorMessage": {
                    "required": {
                      "type": "Missing required property: type"
                    }
                  }
                }
              }
            },
            "required": ["domain", "distributions"],
            "additionalProperties": false,
            "errorMessage": {
              "required": {
                "domain": "Missing required property: domain",
                "distributions": "Missing required property: distributions"
              }
            }
          }
        },
        "saasWorkload": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string",
                "minLength": 1
              },
              "domain": {
                "type": "string",
                "minLength": 1
              },
              "webapp": {
                "type": "boolean"
              },
              "lambdaApi": {
                "type": "boolean"
              },
              "webappS3": {
                "type": "boolean"
              },
              "marketingS3": {
                "type": "boolean"
              },
              "services": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "type": {
                      "type": "string",
                      "enum": ["webapp", "api"]
                    }
                  },
                  "required": ["type"],
                  "additionalProperties": false,
                  "errorMessage": {
                    "required": {
                      "type": "Missing required property: type"
                    }
                  }
                }
              },
              "eventHandlers": {
                "type": "boolean"
              },
              "refreshTokenCleanup": {
                "type": "boolean"
              },
              "stripe": {
                "type": "object",
                "additionalProperties": {
                  "type": "object",
                  "properties": {
                    "priceIdMonthly": {
                      "type": "string"
                    },
                    "priceIdAnnual": {
                      "type": "string"
                    }
                  },
                  "additionalProperties": false
                }
              },
              "scheduledJobs": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "name": {
                      "type": "string",
                      "minLength": 1
                    },
                    "description": {
                      "type": "string"
                    },
                    "schedule": {
                      "type": "string",
                      "minLength": 1
                    },
                    "memorySize": {
                      "type": "number",
                      "minimum": 128,
                      "maximum": 10240
                    },
                    "timeout": {
                      "type": "number",
                      "minimum": 1,
                      "maximum": 900
                    },
                    "enabled": {
                      "type": "boolean"
                    }
                  },
                  "required": ["name", "schedule"],
                  "additionalProperties": false,
                  "errorMessage": {
                    "required": {
                      "name": "Missing required property: name",
                      "schedule": "Missing required property: schedule"
                    }
                  }
                }
              }
            },
            "required": ["name"],
            "additionalProperties": false,
            "errorMessage": {
              "required": {
                "name": "Missing required property: name"
              }
            }
          }
        },
        "organization": {
          "type": "object",
          "properties": {
            "rootId": {
              "type": "string",
              "pattern": "^r-[a-z0-9]{4,32}$"
            },
            "mode": {
              "type": "string",
              "enum": ["create", "adopt"],
              "default": "create"
            },
            "featureSet": {
              "type": "string",
              "enum": ["ALL", "CONSOLIDATED_BILLING"],
              "default": "ALL"
            },
            "organizationalUnits": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "key": {
                    "type": "string",
                    "pattern": "^[a-zA-Z0-9_-]+$"
                  },
                  "name": {
                    "type": "string",
                    "pattern": "^[a-zA-Z0-9\\s_-]+$",
                    "minLength": 1
                  },
                  "accounts": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "key": {
                          "$ref": "4/key"
                        },
                        "name": {
                          "$ref": "4/name"
                        },
                        "email": {
                          "type": "string",
                          "format": "email"
                        },
                        "environment": {
                          "type": "string",
                          "enum": ["nprd", "pprd", "prod", "mgmt", "shrd"]
                        },
                        "purpose": {
                          "type": "string",
                          "minLength": 1,
                          "maxLength": 500
                        },
                        "tags": {
                          "type": "object",
                          "additionalProperties": {
                            "type": "string"
                          }
                        },
                        "accountId": {
                          "$ref": "9/environments/additionalProperties/properties/accountId"
                        }
                      },
                      "required": ["key", "name", "email", "environment", "purpose"],
                      "additionalProperties": false,
                      "errorMessage": {
                        "required": {
                          "key": "Missing required property: key",
                          "name": "Missing required property: name",
                          "email": "Missing required property: email",
                          "environment": "Missing required property: environment",
                          "purpose": "Missing required property: purpose"
                        }
                      }
                    }
                  },
                  "ouId": {
                    "type": "string",
                    "pattern": "^ou-[a-z0-9]{4,32}-[a-z0-9]{8,32}$"
                  },
                  "parentOuId": {
                    "$ref": "1/ouId"
                  },
                  "description": {
                    "type": "string"
                  },
                  "tags": {
                    "type": "object",
                    "additionalProperties": {
                      "type": "string"
                    }
                  }
                },
                "required": ["key", "name", "accounts"],
                "additionalProperties": false,
                "errorMessage": {
                  "required": {
                    "key": "Missing required property: key",
                    "name": "Missing required property: name",
                    "accounts": "Missing required property: accounts"
                  }
                }
              }
            },
            "serviceControlPolicies": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "name": {
                    "$ref": "4/organizationalUnits/items/properties/name"
                  },
                  "description": {
                    "type": "string"
                  },
                  "policyDocument": {
                    "anyOf": [
                      {
                        "type": "string"
                      },
                      {
                        "type": "object",
                        "additionalProperties": {}
                      }
                    ]
                  },
                  "targetType": {
                    "type": "string",
                    "enum": ["ROOT", "OU", "ACCOUNT"]
                  },
                  "targetIds": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  },
                  "tags": {
                    "type": "object",
                    "additionalProperties": {
                      "type": "string"
                    }
                  }
                },
                "required": ["name", "policyDocument", "targetType", "targetIds"],
                "additionalProperties": false,
                "errorMessage": {
                  "required": {
                    "name": "Missing required property: name",
                    "policyDocument": "Missing required property: policyDocument",
                    "targetType": "Missing required property: targetType",
                    "targetIds": "Missing required property: targetIds"
                  }
                }
              }
            },
            "enabledPolicyTypes": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": [
                  "SERVICE_CONTROL_POLICY",
                  "TAG_POLICY",
                  "BACKUP_POLICY",
                  "AISERVICES_OPT_OUT_POLICY"
                ]
              },
              "default": ["SERVICE_CONTROL_POLICY"]
            },
            "tags": {
              "type": "object",
              "additionalProperties": {
                "type": "string"
              }
            }
          },
          "required": ["rootId", "organizationalUnits"],
          "additionalProperties": false,
          "errorMessage": {
            "required": {
              "rootId": "Missing required property: rootId",
              "organizationalUnits": "Missing required property: organizationalUnits"
            }
          }
        },
        "identityCenter": {
          "type": "object",
          "properties": {
            "instanceArn": {
              "type": "string",
              "pattern": "^arn:aws:sso:::instance\\/ssoins-[a-z0-9]{16}$"
            },
            "identityStoreId": {
              "type": "string",
              "pattern": "^d-[a-z0-9]{10}$"
            },
            "identitySource": {
              "type": "object",
              "properties": {
                "type": {
                  "type": "string",
                  "enum": ["INTERNAL", "EXTERNAL"]
                },
                "externalProvider": {
                  "type": "object",
                  "properties": {
                    "samlMetadataDocument": {
                      "type": "string"
                    },
                    "samlMetadataUrl": {
                      "type": "string",
                      "format": "uri"
                    },
                    "attributeMapping": {
                      "type": "object",
                      "additionalProperties": {
                        "type": "string"
                      }
                    }
                  },
                  "additionalProperties": false
                }
              },
              "required": ["type"],
              "additionalProperties": false,
              "errorMessage": {
                "required": {
                  "type": "Missing required property: type"
                }
              }
            },
            "users": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "key": {
                    "$ref": "6/organization/properties/organizationalUnits/items/properties/key"
                  },
                  "userId": {
                    "type": "string",
                    "pattern": "^[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}$"
                  },
                  "userName": {
                    "type": "string",
                    "minLength": 1,
                    "maxLength": 128
                  }
                },
                "required": ["key", "userId"],
                "additionalProperties": false,
                "errorMessage": {
                  "required": {
                    "key": "Missing required property: key",
                    "userId": "Missing required property: userId"
                  }
                }
              }
            },
            "permissionSets": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "name": {
                    "$ref": "6/organization/properties/organizationalUnits/items/properties/name"
                  },
                  "description": {
                    "$ref": "6/organization/properties/organizationalUnits/items/properties/accounts/items/properties/purpose"
                  },
                  "sessionDuration": {
                    "type": "string",
                    "pattern": "^P(?:(\\d+)Y)?(?:(\\d+)M)?(?:(\\d+)D)?(?:T(?:(\\d+)H)?(?:(\\d+)M)?(?:(\\d+)S)?)?$"
                  },
                  "managedPolicies": {
                    "type": "array",
                    "items": {
                      "type": "string",
                      "pattern": "^arn:aws:iam::(aws|\\d{12}):policy\\/[a-zA-Z0-9+=,.@_/-]+$"
                    }
                  },
                  "inlinePolicy": {
                    "anyOf": [
                      {
                        "type": "string"
                      },
                      {
                        "type": "object",
                        "additionalProperties": {}
                      }
                    ]
                  },
                  "customerManagedPolicies": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "$ref": "9/organization/properties/organizationalUnits/items/properties/name"
                        },
                        "path": {
                          "type": "string",
                          "default": "/"
                        }
                      },
                      "required": ["name"],
                      "additionalProperties": false,
                      "errorMessage": {
                        "required": {
                          "name": "Missing required property: name"
                        }
                      }
                    }
                  },
                  "permissionsBoundary": {
                    "type": "object",
                    "properties": {
                      "managedPolicyArn": {
                        "$ref": "3/managedPolicies/items"
                      },
                      "customerManagedPolicy": {
                        "type": "object",
                        "properties": {
                          "name": {
                            "$ref": "10/organization/properties/organizationalUnits/items/properties/name"
                          },
                          "path": {
                            "type": "string",
                            "default": "/"
                          }
                        },
                        "required": ["name"],
                        "additionalProperties": false,
                        "errorMessage": {
                          "required": {
                            "name": "Missing required property: name"
                          }
                        }
                      }
                    },
                    "additionalProperties": false
                  },
                  "tags": {
                    "$ref": "6/organization/properties/organizationalUnits/items/properties/accounts/items/properties/tags"
                  }
                },
                "required": ["name", "description"],
                "additionalProperties": false,
                "errorMessage": {
                  "required": {
                    "name": "Missing required property: name",
                    "description": "Missing required property: description"
                  }
                }
              }
            },
            "assignments": {
              "type": "object",
              "additionalProperties": {
                "type": "object",
                "additionalProperties": {
                  "type": "array",
                  "items": {
                    "$ref": "6/organization/properties/organizationalUnits/items/properties/key"
                  }
                },
                "propertyNames": {
                  "pattern": "^[a-zA-Z0-9\\s_-]+$",
                  "minLength": 1
                }
              },
              "propertyNames": {
                "pattern": "^[a-zA-Z0-9_-]+$"
              }
            },
            "applications": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "name": {
                    "$ref": "6/organization/properties/organizationalUnits/items/properties/name"
                  },
                  "description": {
                    "$ref": "6/organization/properties/organizationalUnits/items/properties/accounts/items/properties/purpose"
                  },
                  "applicationProviderArn": {
                    "type": "string",
                    "pattern": "^arn:aws:[a-zA-Z0-9-]+:[a-zA-Z0-9-]*:\\d{0,12}:[a-zA-Z0-9-_/:.]+$"
                  },
                  "instanceArn": {
                    "$ref": "4/instanceArn"
                  },
                  "status": {
                    "type": "string",
                    "enum": ["ENABLED", "DISABLED"],
                    "default": "ENABLED"
                  },
                  "portalOptions": {
                    "type": "object",
                    "properties": {
                      "visibility": {
                        "type": "string",
                        "enum": ["ENABLED", "DISABLED"],
                        "default": "ENABLED"
                      },
                      "signInOptions": {
                        "type": "object",
                        "properties": {
                          "origin": {
                            "type": "string",
                            "enum": ["IDENTITY_CENTER", "APPLICATION"],
                            "default": "IDENTITY_CENTER"
                          },
                          "applicationUrl": {
                            "type": "string",
                            "format": "uri"
                          }
                        },
                        "additionalProperties": false
                      }
                    },
                    "additionalProperties": false
                  },
                  "tags": {
                    "$ref": "6/organization/properties/organizationalUnits/items/properties/accounts/items/properties/tags"
                  }
                },
                "required": ["name", "applicationProviderArn", "instanceArn"],
                "additionalProperties": false,
                "errorMessage": {
                  "required": {
                    "name": "Missing required property: name",
                    "applicationProviderArn": "Missing required property: applicationProviderArn",
                    "instanceArn": "Missing required property: instanceArn"
                  }
                }
              }
            },
            "trustedTokenIssuers": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "name": {
                    "$ref": "6/organization/properties/organizationalUnits/items/properties/name"
                  },
                  "issuerUrl": {
                    "type": "string",
                    "format": "uri"
                  },
                  "clientToken": {
                    "type": "string"
                  },
                  "trustedTokenIssuerType": {
                    "type": "string",
                    "enum": ["OIDC_JWT"]
                  },
                  "trustedTokenIssuerConfiguration": {
                    "type": "object",
                    "properties": {
                      "issuerUrl": {
                        "type": "string",
                        "format": "uri"
                      },
                      "audienceList": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      },
                      "jwksRetrievalOption": {
                        "type": "string",
                        "enum": ["OPEN_ID_DISCOVERY"],
                        "default": "OPEN_ID_DISCOVERY"
                      }
                    },
                    "required": ["issuerUrl", "audienceList"],
                    "additionalProperties": false,
                    "errorMessage": {
                      "required": {
                        "issuerUrl": "Missing required property: issuerUrl",
                        "audienceList": "Missing required property: audienceList"
                      }
                    }
                  },
                  "tags": {
                    "$ref": "6/organization/properties/organizationalUnits/items/properties/accounts/items/properties/tags"
                  }
                },
                "required": [
                  "name",
                  "issuerUrl",
                  "trustedTokenIssuerType",
                  "trustedTokenIssuerConfiguration"
                ],
                "additionalProperties": false,
                "errorMessage": {
                  "required": {
                    "name": "Missing required property: name",
                    "issuerUrl": "Missing required property: issuerUrl",
                    "trustedTokenIssuerType": "Missing required property: trustedTokenIssuerType",
                    "trustedTokenIssuerConfiguration": "Missing required property: trustedTokenIssuerConfiguration"
                  }
                }
              }
            },
            "tags": {
              "type": "object",
              "properties": {
                "Owner": {
                  "type": "string",
                  "minLength": 1
                },
                "ManagedBy": {
                  "type": "string",
                  "minLength": 1
                }
              },
              "required": ["Owner", "ManagedBy"],
              "additionalProperties": {
                "type": "string"
              },
              "errorMessage": {
                "required": {
                  "Owner": "Missing required property: Owner",
                  "ManagedBy": "Missing required property: ManagedBy"
                }
              }
            }
          },
          "required": ["instanceArn", "permissionSets", "assignments", "tags"],
          "additionalProperties": false,
          "errorMessage": {
            "required": {
              "instanceArn": "Missing required property: instanceArn",
              "permissionSets": "Missing required property: permissionSets",
              "assignments": "Missing required property: assignments",
              "tags": "Missing required property: tags"
            }
          }
        },
        "domains": {
          "type": "object",
          "properties": {
            "nprdAllowedCidrsWaf": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "registeredDomains": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string",
                    "pattern": "^(?:[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\\.)*[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?$",
                    "minLength": 1,
                    "maxLength": 253
                  },
                  "hostedZoneId": {
                    "type": "string",
                    "pattern": "^Z[A-Z0-9]{10,32}$"
                  },
                  "createDelegationRole": {
                    "type": "boolean"
                  },
                  "allowedEnvironments": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  }
                },
                "required": ["name"],
                "additionalProperties": false,
                "errorMessage": {
                  "required": {
                    "name": "Missing required property: name"
                  }
                }
              }
            }
          },
          "additionalProperties": false
        },
        "githubDeployPermissions": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true
            },
            "roleMode": {
              "type": "string",
              "enum": ["split", "single"],
              "default": "split"
            }
          },
          "additionalProperties": false
        },
        "githubOidc": {
          "type": "object",
          "properties": {
            "targets": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "projectName": {
                    "type": "string",
                    "minLength": 1
                  },
                  "repositories": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "owner": {
                          "type": "string",
                          "minLength": 1
                        },
                        "repo": {
                          "type": "string",
                          "minLength": 1
                        },
                        "branch": {
                          "type": "string",
                          "default": "main"
                        },
                        "allowTags": {
                          "type": "boolean",
                          "default": true
                        },
                        "environments": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "default": []
                        }
                      },
                      "required": ["owner", "repo"],
                      "additionalProperties": false,
                      "errorMessage": {
                        "required": {
                          "owner": "Missing required property: owner",
                          "repo": "Missing required property: repo"
                        }
                      }
                    },
                    "minItems": 1
                  },
                  "ecrRepositoryPrefix": {
                    "type": "string"
                  },
                  "s3BucketPrefix": {
                    "type": "string"
                  },
                  "ecsClusterPrefix": {
                    "type": "string"
                  },
                  "targetEnvironments": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    },
                    "minItems": 1
                  }
                },
                "required": ["projectName", "repositories", "targetEnvironments"],
                "additionalProperties": false,
                "errorMessage": {
                  "required": {
                    "projectName": "Missing required property: projectName",
                    "repositories": "Missing required property: repositories",
                    "targetEnvironments": "Missing required property: targetEnvironments"
                  }
                }
              },
              "minItems": 1
            }
          },
          "required": ["targets"],
          "additionalProperties": false,
          "errorMessage": {
            "required": {
              "targets": "Missing required property: targets"
            }
          }
        },
        "networking": {
          "type": "object",
          "properties": {
            "vpc": {
              "type": "object",
              "properties": {
                "cidr": {
                  "type": "string"
                },
                "maxAzs": {
                  "type": "number",
                  "minimum": 1,
                  "maximum": 3
                },
                "natGateways": {
                  "type": "number",
                  "minimum": 0,
                  "maximum": 3
                },
                "enableFlowLogs": {
                  "type": "boolean"
                },
                "flowLogsRetentionDays": {
                  "type": "number"
                }
              },
              "additionalProperties": false
            }
          },
          "additionalProperties": false
        },
        "compute": {
          "type": "object",
          "properties": {
            "ecs": {
              "type": "object",
              "properties": {
                "enabled": {
                  "type": "boolean"
                },
                "certificateArn": {
                  "type": "string"
                },
                "services": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "name": {
                        "type": "string",
                        "minLength": 1
                      },
                      "type": {
                        "type": "string",
                        "enum": ["webapp", "api", "worker"]
                      },
                      "enabled": {
                        "type": "boolean",
                        "default": true
                      },
                      "brands": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      },
                      "defaultBrand": {
                        "type": "string"
                      },
                      "containerPort": {
                        "type": "number",
                        "minimum": 1,
                        "maximum": 65535,
                        "default": 3000
                      },
                      "healthCheckPath": {
                        "type": "string",
                        "default": "/health"
                      },
                      "desiredCount": {
                        "type": "number",
                        "minimum": 0,
                        "default": 1
                      },
                      "cpu": {
                        "type": "number",
                        "default": 256
                      },
                      "memoryMiB": {
                        "type": "number",
                        "default": 512
                      }
                    },
                    "required": ["type"],
                    "additionalProperties": false,
                    "errorMessage": {
                      "required": {
                        "type": "Missing required property: type"
                      }
                    }
                  },
                  "minItems": 1
                }
              },
              "required": ["enabled", "services"],
              "additionalProperties": false,
              "errorMessage": {
                "required": {
                  "enabled": "Missing required property: enabled",
                  "services": "Missing required property: services"
                }
              }
            }
          },
          "additionalProperties": false
        },
        "aurora": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": false
            },
            "engine": {
              "type": "string",
              "const": "aurora-postgresql",
              "default": "aurora-postgresql"
            },
            "engineVersion": {
              "type": "string",
              "default": "16.4"
            },
            "minCapacity": {
              "type": "number",
              "minimum": 0.5,
              "maximum": 128,
              "default": 0.5
            },
            "maxCapacity": {
              "type": "number",
              "minimum": 0.5,
              "maximum": 128,
              "default": 2
            },
            "databases": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "default": []
            },
            "backupRetentionDays": {
              "type": "number",
              "minimum": 1,
              "maximum": 35,
              "default": 7
            },
            "deletionProtection": {
              "type": "boolean",
              "default": true
            },
            "performanceInsights": {
              "type": "boolean",
              "default": true
            },
            "performanceInsightsRetention": {
              "type": "number",
              "minimum": 7,
              "maximum": 731,
              "default": 7
            }
          },
          "additionalProperties": false
        },
        "staticHosting": {
          "type": "object",
          "properties": {
            "managementAccountId": {
              "$ref": "3/environments/additionalProperties/properties/accountId"
            }
          },
          "additionalProperties": false
        },
        "secrets": {
          "type": "object",
          "properties": {
            "recoveryWindowInDays": {
              "type": "number",
              "minimum": 7,
              "maximum": 30
            },
            "brands": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "items": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "key": {
                    "type": "string"
                  },
                  "description": {
                    "type": "string"
                  },
                  "generated": {
                    "type": "boolean"
                  },
                  "length": {
                    "type": "number",
                    "minimum": 16,
                    "maximum": 128
                  },
                  "perBrand": {
                    "type": "boolean"
                  },
                  "jsonFields": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  }
                },
                "required": ["key"],
                "additionalProperties": false,
                "errorMessage": {
                  "required": {
                    "key": "Missing required property: key"
                  }
                }
              }
            }
          },
          "additionalProperties": false
        },
        "originZones": {
          "type": "object",
          "properties": {
            "brands": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          },
          "required": ["brands"],
          "additionalProperties": false,
          "errorMessage": {
            "required": {
              "brands": "Missing required property: brands"
            }
          }
        },
        "lambda": {
          "type": "object",
          "properties": {
            "functions": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string",
                    "minLength": 1
                  },
                  "memorySize": {
                    "type": "number",
                    "minimum": 128,
                    "maximum": 10240
                  },
                  "timeout": {
                    "type": "number",
                    "minimum": 1,
                    "maximum": 900
                  },
                  "reservedConcurrentExecutions": {
                    "type": "number",
                    "minimum": 0
                  },
                  "environment": {
                    "type": "object",
                    "additionalProperties": {
                      "type": "string"
                    }
                  },
                  "ecrRepositoryName": {
                    "type": "string"
                  },
                  "imageTag": {
                    "type": "string"
                  }
                },
                "required": ["name"],
                "additionalProperties": false,
                "errorMessage": {
                  "required": {
                    "name": "Missing required property: name"
                  }
                }
              }
            },
            "eventBridgeBusName": {
              "type": "string"
            }
          },
          "additionalProperties": false
        },
        "infrastructure": {
          "type": "object",
          "properties": {
            "targetEnvironments": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "importVpcFromSsm": {
              "type": "boolean"
            },
            "vpc": {
              "type": "object",
              "properties": {
                "cidr": {
                  "type": "string"
                },
                "maxAzs": {
                  "type": "number",
                  "minimum": 1,
                  "maximum": 3
                },
                "natGateways": {
                  "type": "number",
                  "minimum": 0,
                  "maximum": 3
                },
                "enableFlowLogs": {
                  "type": "boolean"
                },
                "flowLogsRetentionDays": {
                  "type": "number"
                }
              },
              "additionalProperties": false
            },
            "alb": {
              "type": "object",
              "properties": {
                "internal": {
                  "type": "boolean"
                }
              },
              "additionalProperties": false
            },
            "commonParams": {
              "type": "object",
              "properties": {
                "accountIds": {
                  "type": "boolean"
                }
              },
              "additionalProperties": false
            }
          },
          "additionalProperties": false
        }
      },
      "required": ["naming", "environments"],
      "additionalProperties": false,
      "errorMessage": {
        "required": {
          "naming": "Missing required property: naming",
          "environments": "Missing required property: environments"
        }
      }
    }
  },
  "$defs": {
    "AwsAccountId": {
      "type": "string",
      "pattern": "^\\d{12}$",
      "description": "AWS Account ID - exactly 12 digits",
      "errorMessage": {
        "pattern": "AWS Account ID must be exactly 12 digits (e.g., \"123456789012\")"
      }
    },
    "AwsRegion": {
      "type": "string",
      "pattern": "^[a-z]{2}-[a-z]+-\\d{1,2}$",
      "description": "AWS Region identifier (e.g., us-east-1, eu-west-2)",
      "errorMessage": {
        "pattern": "AWS Region must follow the format: {region}-{location}-{number} (e.g., \"us-east-1\")"
      }
    },
    "AwsArn": {
      "type": "string",
      "pattern": "^arn:aws:[a-zA-Z0-9-]+:[a-z0-9-]*:\\d{12}:[a-zA-Z0-9-_/:.]+$",
      "description": "AWS ARN (Amazon Resource Name)",
      "errorMessage": {
        "pattern": "AWS ARN must follow the format: arn:aws:service:region:account-id:resource"
      }
    },
    "ProjectName": {
      "type": "string",
      "minLength": 2,
      "maxLength": 63,
      "pattern": "^[a-z][a-z0-9-]*[a-z0-9]$",
      "description": "Project name - lowercase, alphanumeric with hyphens, 2-63 characters",
      "errorMessage": {
        "minLength": "Project name must be at least 2 characters long",
        "maxLength": "Project name must be no more than 63 characters long",
        "pattern": "Project name must start with a letter, contain only lowercase letters, numbers, and hyphens, and end with a letter or number"
      }
    },
    "EnvCode": {
      "enum": ["mgmt", "shrd", "nprd", "pprd", "prod"],
      "description": "Environment code - standardized environment identifier",
      "errorMessage": {
        "enum": "Environment code must be one of: mgmt (management), shrd (shared), nprd (non-production), pprd (pre-production), prod (production)"
      }
    },
    "EmailAddress": {
      "type": "string",
      "format": "email",
      "maxLength": 254,
      "description": "Valid email address",
      "errorMessage": {
        "format": "Must be a valid email address (e.g., \"user@example.com\")",
        "maxLength": "Email address must be no more than 254 characters long"
      }
    },
    "CompanyName": {
      "type": "string",
      "minLength": 1,
      "maxLength": 100,
      "pattern": "^[\\w\\s&.-]+$",
      "description": "Company or organization name",
      "errorMessage": {
        "minLength": "Company name is required",
        "maxLength": "Company name must be no more than 100 characters long",
        "pattern": "Company name can contain letters, numbers, spaces, and common punctuation (&.-)"
      }
    },
    "TagMap": {
      "type": "object",
      "patternProperties": {
        "^[a-zA-Z0-9+\\-=._:/@]+$": {
          "type": "string",
          "maxLength": 256
        }
      },
      "additionalProperties": false,
      "description": "AWS resource tags - key-value pairs for resource organization",
      "errorMessage": {
        "additionalProperties": "Tag keys must match AWS tag key requirements (letters, numbers, and +\\-=._:/@)"
      }
    },
    "VpcCidr": {
      "type": "string",
      "pattern": "^(10\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})/(1[6-9]|2[0-8]))|(172\\.(1[6-9]|2\\d|3[01])\\.(\\d{1,3})\\.(\\d{1,3})/(1[6-9]|2[0-8]))|(192\\.168\\.(\\d{1,3})\\.(\\d{1,3})/(1[6-9]|2[0-8]))$",
      "description": "VPC CIDR block - private IP range for the VPC",
      "errorMessage": {
        "pattern": "VPC CIDR must be a valid private IP range (10.0.0.0/16-28, 172.16.0.0/16-28, or 192.168.0.0/16-28)"
      }
    },
    "BaseManifest": {
      "type": "object",
      "properties": {
        "project": {
          "$ref": "#/$defs/ProjectName"
        },
        "company": {
          "$ref": "#/$defs/CompanyName"
        }
      },
      "required": ["project", "company"],
      "additionalProperties": false,
      "description": "Base properties required for all manifest types",
      "errorMessage": {
        "required": {
          "0": "A",
          "1": "l",
          "2": "l",
          "3": " ",
          "4": "m",
          "5": "a",
          "6": "n",
          "7": "i",
          "8": "f",
          "9": "e",
          "10": "s",
          "11": "t",
          "12": "s",
          "13": " ",
          "14": "m",
          "15": "u",
          "16": "s",
          "17": "t",
          "18": " ",
          "19": "i",
          "20": "n",
          "21": "c",
          "22": "l",
          "23": "u",
          "24": "d",
          "25": "e",
          "26": " ",
          "27": "p",
          "28": "r",
          "29": "o",
          "30": "j",
          "31": "e",
          "32": "c",
          "33": "t",
          "34": " ",
          "35": "a",
          "36": "n",
          "37": "d",
          "38": " ",
          "39": "c",
          "40": "o",
          "41": "m",
          "42": "p",
          "43": "a",
          "44": "n",
          "45": "y",
          "46": " ",
          "47": "p",
          "48": "r",
          "49": "o",
          "50": "p",
          "51": "e",
          "52": "r",
          "53": "t",
          "54": "i",
          "55": "e",
          "56": "s",
          "project": "Missing required property: project",
          "company": "Missing required property: company"
        },
        "additionalProperties": "Base manifest cannot contain additional properties beyond project and company"
      }
    }
  },
  "unevaluatedProperties": false
}
